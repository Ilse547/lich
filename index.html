<html>
    <head>
        <title>Thatdown</title>
        <script src="https://cdn.jsdelivr.net/npm/gun/gun.js"></script>
        <link rel="stylesheet" href="./style/style.css">
        <link rel="icon" href="img/whatb.png" type="image/x-icon">
    </head>
    <body>
        <style>
            body {
    margin: 0;
    height: 100vh;
    display: flex;
    font-family: Arial, sans-serif;
}

.sidebar {
  display: flex;
  flex-direction: column;
  width: 200px;
  background-color: var(--sidebar-bg, #2D3748);
  color: var(--sidebar-text, #E2E8F0);
  padding: 1rem;
  overflow-y: auto;
}

.sidebar a{
  margin: 5px;
  margin-left: 0;
  border: #1f2937;
  border-color: #3b82f6;
}

.nav-divider{
  width: 200px;
}

#username_input{
  background-color: #007bff; 
  color: white; 
  border: none; 
  border-radius: 4px; 
  font-size: 16px; 
  cursor: pointer; 
  margin-bottom: 5px;
}
#set-UN-btn{
  background-color: #007bff; 
  color: white; 
  border: none; 
  border-radius: 4px; 
  font-size: 16px; 
  cursor: pointer; 
  margin-bottom: 5px;
  size: 15px;
}

.chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100vh;
}

.chat {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
    background-color: var(--main-bg, #5474ff);
    display: flex;
    flex-direction: column;
}

.chat h1 {
    margin: 0 0 1rem 0;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e2e8f0;
}

#messages {
    flex: 1;
    overflow-y: auto;
    padding-bottom: 1rem;
}
.inputbar {
    padding: 1rem;
    background-color: white;
    border-top: 1px solid #e2e8f0;
    display: flex;
    gap: 0.5rem;
}

#message-input {
    flex: 1;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.5rem;
    font-size: 1rem;
}

#send-btn {
    padding: 0.75rem 1.5rem;
    background-color: #3b82f6;
    color: white;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    font-size: 1rem;
}

#send-btn:hover {
    background-color: #2563eb;
}

.message {
    margin-bottom: 0.5rem;
    padding: 0.5rem;
    background-color: white;
    border-radius: 0.5rem;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.message strong {
    color: #1f2937;
}

.message small {
    color: #6b7280;
    margin-left: 0.5rem;
}

        </style>
        <nav class="sidebar">
            <div class="username-section">
                <h3>Your Name</h3>
                <div class="username-input-group">
                    <input type="text" id="username-input" placeholder="Enter your name" maxlength="20">
                    <button id="set-username-btn">Set</button>
                </div>
                <div id="current-user" class="current-user hidden">
                    <span>ðŸ‘¤</span>
                    <span id="current-username">Anonymous</span>
                    <button id="edit-username-btn">Edit</button>
                </div>
            </div>
            <hr class="nav-divider">
            <a>Chat</a>
            <a>Chat</a>
            <a>Chat</a>
            <a>Chat</a>
        </nav>
        
        <div class="chat-container">
            <main class="chat">
                <h1>H1 chat ?</h1>
                <div id="messages"></div>
            </main>
            
            <div class="inputbar">
                <input type="text" id="message-input" placeholder="Type a message...">
                <button id="send-btn">Send</button> 
            </div>
        </div>

        <script>




const gun = GUN([
    'http://192.168.178.21:3000/gun',
    'https://gun-manhattan.herokuapp.com/gun',
    'https://gun-us.herokuapp.com/gun'
]);

const chat = gun.get('general-chat');
let username = localStorage.getItem('chatUsername');

// DOM elements
const usernameInput = document.getElementById('username-input');
const setUsernameBtn = document.getElementById('set-username-btn');
const currentUserDiv = document.getElementById('current-user');
const currentUsernameSpan = document.getElementById('current-username');
const editUsernameBtn = document.getElementById('edit-username-btn');
const usernameInputGroup = document.querySelector('.username-input-group');

// Initialize username display
function initializeUsername() {
    if (username && username.trim()) {
        showCurrentUser(username);
    } else {
        showUsernameInput();
    }
}

function showUsernameInput() {
    usernameInputGroup.classList.remove('hidden');
    currentUserDiv.classList.add('hidden');
    usernameInput.focus();
}

function showCurrentUser(name) {
    usernameInputGroup.classList.add('hidden');
    currentUserDiv.classList.remove('hidden');
    currentUsernameSpan.textContent = name;
}

function setUsername() {
    const newUsername = usernameInput.value.trim();
    if (newUsername) {
        username = newUsername;
        localStorage.setItem('chatUsername', username);
        showCurrentUser(username);
        usernameInput.value = '';
    }
}

// Event listeners
setUsernameBtn.addEventListener('click', setUsername);

usernameInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        setUsername();
    }
});

editUsernameBtn.addEventListener('click', () => {
    usernameInput.value = username;
    showUsernameInput();
});

// Send message
document.getElementById('send-btn').addEventListener('click', () => {
    const input = document.getElementById('message-input');
    if (input.value.trim() && username) {
        const message = {
            text: input.value.trim(),
            user: username,
            timestamp: Date.now(),
            id: 'msg_' + Date.now() + '_' + Math.random().toString(36).substring(2,9)
        };
        chat.get('messages').get(message.id).put(message);
        input.value = '';
    } else if (!username) {
        alert('Please set your name first!');
        usernameInput.focus();
    }
});

// Message input Enter key
document.getElementById('message-input').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        document.getElementById('send-btn').click();
    }
});

// Listen for messages
chat.get('messages').map().on((message, key) => {
    if (message && message.text && message.user && message.id) {
        if (!document.getElementById(message.id)) {
            displayMessage(message);
        }
    }
});

function displayMessage(message) {
    const messageDiv = document.getElementById('messages');
    const messageEl = document.createElement('div');
    messageEl.id = message.id;
    messageEl.className = 'message';
    
    // Style your own messages differently
    if (message.user === username) {
        messageEl.classList.add('own-message');
    }
    
    messageEl.innerHTML = 
        `<strong>${message.user}:</strong> ${message.text}
        <small>${new Date(message.timestamp).toLocaleTimeString()}</small>`;
    messageDiv.appendChild(messageEl);
    messageDiv.scrollTop = messageDiv.scrollHeight;
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', initializeUsername);

        </script>
    </body>
</html>
